<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de GestÃ£o de ReforÃ§o - Vigilantes</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="header">
        <h1>ğŸ›¡ï¸ Sistema de GestÃ£o de ReforÃ§o</h1>
        <p>Escala 12x36 - Controle de PlantÃµes e Folgas</p>
    </div>

    <div class="tabs">
        <button class="tab-button active" data-tab="cadastro">ğŸ“… Cadastrar PlantÃ£o</button>
        <button class="tab-button" data-tab="folgas">ğŸ‘¥ Solicitar Folga</button>
        <button class="tab-button" data-tab="visualizar">ğŸ“‹ Visualizar</button>
        <button class="tab-button" data-tab="admin">âš™ï¸ AdministraÃ§Ã£o</button>
        <button class="tab-button" data-tab="login">ğŸ” <span id="loginTabText">Login</span></button>
    </div>

    <div class="container">
        <!-- CADASTRO PLANTÃƒO -->
        <div id="cadastro" class="card active">
            <h2>ğŸ“… Cadastrar PlantÃ£o de ReforÃ§o</h2>
            
            <div id="alertEscala" class="alert alert-warning">
                <span>âš ï¸</span>
                <div>
                    <strong>Escala nÃ£o configurada</strong>
                    <p class="text-small">O administrador ainda nÃ£o configurou a escala do mÃªs.</p>
                </div>
            </div>

            <div class="grid">
                <div class="form-group">
                    <label>MatrÃ­cula (4 dÃ­gitos)</label>
                    <input type="text" id="plantaoMatricula" maxlength="4" placeholder="Ex: 1234">
                </div>
                <div class="form-group">
                    <label>Nome do Vigilante</label>
                    <input type="text" id="plantaoNome" placeholder="Nome completo">
                </div>
            </div>

            <div class="grid">
                <div class="form-group">
                    <label>Data do ReforÃ§o</label>
                    <input type="date" id="plantaoData" onchange="updatePostos()">
                    <p id="alertFimSemana" class="text-small" style="color: var(--danger); display: none; margin-top: 0.5rem;"></p>
                </div>
                <div class="form-group" id="postoGroup" style="display: none;">
                    <label>Posto DisponÃ­vel</label>
                    <select id="plantaoPosto">
                        <option value="">Selecione um posto</option>
                    </select>
                </div>
            </div>

            <button class="btn btn-primary" onclick="cadastrarPlantao()">Cadastrar PlantÃ£o</button>

            <h3 style="margin-top: 2rem; color: var(--primary-500);">ğŸ“‹ Resumo dos PlantÃµes</h3>
            <div id="resumoPlantoes"></div>
        </div>

        <!-- FOLGAS -->
        <div id="folgas" class="card">
            <h2>ğŸ‘¥ Solicitar Folga</h2>
            
            <div id="alertFolgas" class="alert alert-warning">
                <span>âš ï¸</span>
                <div>
                    <strong>Folgas nÃ£o habilitadas</strong>
                    <p class="text-small">O administrador ainda nÃ£o habilitou o cadastro de folgas.</p>
                </div>
            </div>

            <div class="info-box info-box-dark">
                <h4>ğŸ“Š Vagas DisponÃ­veis</h4>
                <p>â€¢ Equipe Interna: <strong>8 vagas</strong> por data</p>
                <p>â€¢ Equipe Externa: <strong>8 vagas</strong> por data</p>
                <p style="margin-top: 0.5rem; padding-top: 0.5rem; border-top: 1px solid rgba(0,0,0,0.1);">
                    <strong>Total: 16 vigilantes por fim de semana/feriado</strong>
                </p>
            </div>

            <div class="info-box">
                <h4>Folgas Solicitadas</h4>
                <p>Interna: <span id="folgasInterna">0</span> folgas | Externa: <span id="folgasExterna">0</span> folgas</p>
            </div>

            <div class="grid">
                <div class="form-group">
                    <label>MatrÃ­cula (4 dÃ­gitos)</label>
                    <input type="text" id="folgaMatricula" maxlength="4" placeholder="Ex: 1234">
                </div>
                <div class="form-group">
                    <label>Nome do Vigilante</label>
                    <input type="text" id="folgaNome" placeholder="Nome completo">
                </div>
            </div>

            <div class="grid">
                <div class="form-group">
                    <label>Equipe</label>
                    <select id="folgaEquipe" onchange="checkFimSemanaFolga()">
                        <option value="">Selecione a equipe</option>
                        <option value="Interna">Interna</option>
                        <option value="Externa">Externa</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Data da Folga</label>
                    <input type="date" id="folgaData" onchange="checkFimSemanaFolga()">
                    <p id="alertFolgaData" class="text-small" style="color: var(--danger); display: none; margin-top: 0.5rem;"></p>
                    <p id="vagasDataInfo" class="text-small" style="display: none; margin-top: 0.5rem; font-weight: 600;"></p>
                </div>
            </div>

            <button class="btn btn-success" id="btnFolga" onclick="cadastrarFolga()" disabled>Solicitar Folga</button>
        </div>

        <!-- VISUALIZAR -->
        <div id="visualizar" class="card">
            <h2>ğŸ“‹ Visualizar Cadastros</h2>
            
            <div class="loading" id="loadingVisualizar">Carregando dados...</div>
            
            <div id="tabelasContainer" style="display: none;">
                <div style="margin-bottom: 2.5rem;">
                    <h3 style="color: var(--primary-500); margin-bottom: 1rem; font-size: 1.2rem;">
                        ğŸ¢ PlantÃµes Cadastrados <span class="badge badge-primary" id="totalPlantoes">0</span>
                    </h3>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>MatrÃ­cula</th>
                                    <th>Nome</th>
                                    <th>Data</th>
                                    <th>Posto</th>
                                    <th id="acoesPlantaoHeader" style="display: none;">AÃ§Ãµes</th>
                                </tr>
                            </thead>
                            <tbody id="tabelaPlantoes">
                                <tr><td colspan="5">Nenhum plantÃ£o cadastrado.</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div>
                    <h3 style="color: var(--primary-500); margin-bottom: 1rem; font-size: 1.2rem;">
                        ğŸ‘¥ Folgas Solicitadas <span class="badge badge-primary" id="totalFolgas">0</span>
                    </h3>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>MatrÃ­cula</th>
                                    <th>Nome</th>
                                    <th>Equipe</th>
                                    <th>Data</th>
                                    <th id="acoesFolgaHeader" style="display: none;">AÃ§Ãµes</th>
                                </tr>
                            </thead>
                            <tbody id="tabelaFolgas">
                                <tr><td colspan="5">Nenhuma folga solicitada.</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div id="adminNotice" class="alert alert-info" style="display: none; margin-top: 2rem;">
                    <span>âœ“</span>
                    <div>
                        <strong>Modo Administrador Ativo</strong>
                        <p class="text-small">VocÃª pode remover cadastros clicando no botÃ£o de aÃ§Ã£o.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- ADMINISTRAÃ‡ÃƒO -->
        <div id="admin" class="card">
            <h2>âš™ï¸ Painel de AdministraÃ§Ã£o</h2>
            
            <div id="adminRestricted" class="alert alert-error">
                <span>ğŸ”</span>
                <div>
                    <strong>Acesso Restrito</strong>
                    <p class="text-small">FaÃ§a login na aba "Login" para acessar esta seÃ§Ã£o.</p>
                </div>
            </div>

            <div id="adminPanel" style="display: none;" class="flex-col">
                <div class="info-box">
                    <h4>Configurar Escala do MÃªs</h4>
                    <div class="grid">
                        <div class="form-group">
                            <label>Tipo</label>
                            <select id="tipoEscala">
                                <option value="impar">Dias Ãmpares</option>
                                <option value="par">Dias Pares</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>MÃªs</label>
                            <select id="mesEscala">
                                <option value="1">Janeiro</option><option value="2">Fevereiro</option><option value="3">MarÃ§o</option>
                                <option value="4">Abril</option><option value="5">Maio</option><option value="6">Junho</option>
                                <option value="7">Julho</option><option value="8">Agosto</option><option value="9">Setembro</option>
                                <option value="10">Outubro</option><option value="11">Novembro</option><option value="12">Dezembro</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Ano</label>
                            <input type="number" id="anoEscala" value="2025">
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="configurarEscala()">Enviar Escala</button>
                    <div id="escalaConfigurada" class="alert alert-success" style="display: none; margin-top: 1rem;">
                        <span>âœ“</span>
                        <div>
                            <strong>Escala configurada:</strong> <span id="escalaInfo"></span>
                        </div>
                    </div>
                </div>

                <div class="info-box">
                    <h4>Controle de Folgas</h4>
                    <button class="btn btn-warning" id="btnToggleFolgas" onclick="toggleFolgas()">Habilitar Folgas</button>
                    <p class="text-small" style="margin-top: 0.75rem;">Status: <span id="statusFolgas">âœ— Desabilitadas</span></p>
                </div>

                <div class="info-box">
                    <h4>Gerenciar Feriados</h4>
                    <div class="form-group">
                        <label>Adicionar Feriado</label>
                        <input type="date" id="dataFeriado">
                    </div>
                    <div class="flex">
                        <button class="btn btn-primary" onclick="adicionarFeriado()">â• Adicionar</button>
                        <button class="btn btn-danger" onclick="limparFeriados()">ğŸ—‘ï¸ Limpar</button>
                    </div>
                    <div style="margin-top: 1rem;">
                        <p class="text-small"><strong>Feriados Cadastrados (<span id="totalFeriados">0</span>):</strong></p>
                        <div id="feriadosContainer" style="margin-top: 0.75rem; max-height: 250px; overflow-y: auto;">
                            <p class="text-small">Nenhum feriado cadastrado.</p>
                        </div>
                    </div>
                </div>

                <div class="info-box">
                    <h4>Escala Manual (Personalizada)</h4>
                    <div class="form-group">
                        <label>Adicionar Data</label>
                        <input type="date" id="dataManual">
                    </div>
                    <div class="flex">
                        <button class="btn btn-primary" onclick="adicionarDataManual()">â• Adicionar</button>
                        <button class="btn btn-danger" onclick="limparEscalaManual()">ğŸ—‘ï¸ Limpar</button>
                    </div>
                    <div style="margin-top: 1rem;">
                        <p class="text-small"><strong>Datas Configuradas (<span id="totalDatasManual">0</span>):</strong></p>
                        <div id="datasManualContainer" style="margin-top: 0.75rem; max-height: 250px; overflow-y: auto;">
                            <p class="text-small">Nenhuma data adicionada.</p>
                        </div>
                    </div>
                </div>

                <div class="info-box">
                    <h4>Gerenciar Dados</h4>
                    <div class="flex">
                        <button class="btn btn-success" onclick="exportarDados()">ğŸ“¥ Exportar Excel</button>
                        <button class="btn btn-danger" onclick="limparDados()">ğŸ—‘ï¸ Limpar Tudo</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- LOGIN -->
        <div id="login" class="card">
            <h2>ğŸ” Acesso Administrativo</h2>
            
            <div id="loginForm" style="max-width: 400px;">
                <p class="text-small" style="margin-bottom: 1.5rem;">FaÃ§a login com sua senha de administrador.</p>
                <div class="form-group">
                    <label>Senha</label>
                    <input type="password" id="adminPassword" placeholder="Digite sua senha">
                </div>
                <button class="btn btn-primary" style="width: 100%;" onclick="fazerLogin()">Fazer Login</button>
            </div>

            <div id="adminLoggedIn" style="display: none;">
                <div class="alert alert-success">
                    <span>âœ“</span>
                    <div>
                        <strong>VocÃª estÃ¡ logado como Administrador</strong>
                    </div>
                </div>
                <div class="flex" style="margin-top: 1rem;">
                    <button class="btn btn-primary" onclick="changeTab('admin', document.querySelectorAll('.tab-button')[3])">Ir para AdministraÃ§Ã£o</button>
                    <button class="btn btn-danger" onclick="fazerLogout()">Fazer Logout</button>
                </div>
            </div>
        </div>
    </div>

    <div class="footer">
        <p><strong>Sistema de GestÃ£o de ReforÃ§o v2.0</strong></p>
        <p id="adminFooter" style="font-size: 0.9rem; margin-top: 0.5rem; display: none;">ğŸ” Modo Administrador Ativo</p>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="js/config.js"></script>
    <script src="js/main.js"></script>
</body>
</html>